<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LinkSnap - Advanced URL Shortener</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Three.js CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <!-- React and ReactDOM CDNs -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <!-- Recharts CDN (for analytics chart) -->
    <script src="https://unpkg.com/recharts/umd/Recharts.min.js"></script>
    <!-- Babel Standalone for JSX in browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        /* Custom animations for UI/UX */
        @keyframes slideUp {
          from {
            opacity: 0;
            transform: translateY(20px) translateX(-50%);
          }
          to {
            opacity: 1;
            transform: translateY(0) translateX(-50%);
          }
        }

        @keyframes fadeIn {
          from {
            opacity: 0;
            transform: translateY(10px);
          }
          to {
            opacity: 1;
            transform: translateY(0);
          }
        }

        /* Apply animations */
        .animate-slideUp {
          animation: slideUp 0.3s ease-out forwards;
        }

        .animate-fadeIn {
          animation: fadeIn 0.5s ease-out forwards;
        }

        /* For the 3D background (if not handled by ThreeJSBackground component directly) */
        .bg-animated-gradient {
            background-size: 200% 200%;
            animation: gradientShift 15s ease infinite;
        }

        @keyframes gradientShift {
          0% { background-position: 0% 50%; }
          50% { background-position: 100% 50%; }
          100% { background-position: 0% 50%; }
        }

        /* Ensure font-family is consistent */
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useRef } = React;

        // Helper to generate a slightly more complex simulated SVG QR code
        const generateQRCodeSVG = (text, size = 128) => {
          if (!text) return '';

          // This is still a SIMULATED QR code. For a real QR code, use a library like 'qrcode.react'.
          // We're just making the placeholder look a bit more like a QR code.
          const moduleSize = size / 10; // Divide into a 10x10 grid for simplicity
          let rects = '';
          // Add some random-ish black squares to simulate QR code patterns
          for (let i = 0; i < 10; i++) {
            for (let j = 0; j < 10; j++) {
              if (Math.random() > 0.6 || (i < 3 && j < 3) || (i > 6 && j < 3) || (i < 3 && j > 6)) {
                rects += `<rect x="${i * moduleSize}" y="${j * moduleSize}" width="${moduleSize}" height="${moduleSize}" fill="#000"/>`;
              }
            }
          }

          const svgContent = `
            <svg width="${size}" height="${size}" viewBox="0 0 ${size} ${size}" fill="none" xmlns="http://www.w3.org/2000/svg">
              <rect x="0" y="0" width="${size}" height="${size}" fill="#fff"/>
              ${rects}
              <text x="50%" y="50%" font-family="Inter, sans-serif" font-size="10" fill="#fff" text-anchor="middle" dominant-baseline="middle">QR Code</text>
              <text x="50%" y="70%" font-family="Inter, sans-serif" font-size="8" fill="#fff" text-anchor="middle" dominant-baseline="middle">(Simulated)</text>
            </svg>
          `;
          return `data:image/svg+xml;base64,${btoa(svgContent)}`;
        };

        // Custom Toast Notification Component
        const Toast = ({ message, type, onClose }) => {
          useEffect(() => {
            const timer = setTimeout(() => {
              onClose();
            }, 3000); // Toast disappears after 3 seconds
            return () => clearTimeout(timer);
          }, [onClose]);

          const bgColor = type === 'success' ? 'bg-green-500' : 'bg-red-500';

          return (
            <div className={`fixed bottom-5 left-1/2 -translate-x-1/2 px-6 py-3 rounded-lg shadow-lg text-white ${bgColor} z-50 transition-all duration-300 ease-out transform animate-slideUp`}>
              {message}
            </div>
          );
        };

        // Three.js Background Component
        const ThreeJSBackground = () => {
          const mountRef = useRef(null);

          useEffect(() => {
            const currentMount = mountRef.current;
            if (!currentMount) return;

            // Scene setup
            const scene = new THREE.Scene();
            scene.background = null; // Transparent background

            // Camera setup
            const camera = new THREE.PerspectiveCamera(75, currentMount.clientWidth / currentMount.clientHeight, 0.1, 1000);
            camera.position.z = 5;

            // Renderer setup
            const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true }); // alpha: true for transparency
            renderer.setSize(currentMount.clientWidth, currentMount.clientHeight);
            currentMount.appendChild(renderer.domElement);

            // Add some simple shapes (e.g., rotating cubes)
            const geometry = new THREE.BoxGeometry(1, 1, 1);
            const material1 = new THREE.MeshBasicMaterial({ color: 0x8844ee, transparent: true, opacity: 0.6 });
            const material2 = new THREE.MeshBasicMaterial({ color: 0x44ee88, transparent: true, opacity: 0.6 });
            const material3 = new THREE.MeshBasicMaterial({ color: 0xee8844, transparent: true, opacity: 0.6 });

            const cube1 = new THREE.Mesh(geometry, material1);
            cube1.position.set(-2, 1, 0);
            scene.add(cube1);

            const cube2 = new THREE.Mesh(geometry, material2);
            cube2.position.set(2, -1, 0);
            scene.add(cube2);

            const cube3 = new THREE.Mesh(geometry, material3);
            cube3.position.set(0, 0, -2);
            scene.add(cube3);

            // Animation loop
            const animate = () => {
              requestAnimationFrame(animate);

              cube1.rotation.x += 0.005;
              cube1.rotation.y += 0.005;

              cube2.rotation.x -= 0.007;
              cube2.rotation.y += 0.007;

              cube3.rotation.x += 0.003;
              cube3.rotation.y -= 0.003;

              renderer.render(scene, camera);
            };

            // Handle window resize
            const handleResize = () => {
              camera.aspect = currentMount.clientWidth / currentMount.clientHeight;
              camera.updateProjectionMatrix();
              renderer.setSize(currentMount.clientWidth, currentMount.clientHeight);
            };

            window.addEventListener('resize', handleResize);
            animate();

            // Cleanup on component unmount
            return () => {
              window.removeEventListener('resize', handleResize);
              currentMount.removeChild(renderer.domElement);
              renderer.dispose();
              geometry.dispose();
              material1.dispose();
              material2.dispose();
              material3.dispose();
            };
          }, []);

          return <div ref={mountRef} className="absolute inset-0 z-0 pointer-events-none"></div>;
        };

        // Header Component
        const Header = ({ onNavigate, currentView }) => (
          <header className="bg-gradient-to-r from-purple-700 to-pink-600 text-white p-6 rounded-t-xl shadow-lg relative z-20">
            <div className="container mx-auto flex justify-between items-center">
              <h1 className="text-3xl font-bold tracking-tight">ðŸ”— LinkSnap</h1>
              <nav>
                <ul className="flex space-x-6">
                  <li>
                    <button
                      onClick={() => onNavigate('home')}
                      className={`font-semibold ${currentView === 'home' ? 'text-white border-b-2 border-white' : 'hover:text-purple-200'} transition duration-300 pb-1`}
                    >
                      Home
                    </button>
                  </li>
                  <li>
                    <button
                      onClick={() => onNavigate('links')}
                      className={`font-semibold ${currentView === 'links' ? 'text-white border-b-2 border-white' : 'hover:text-purple-200'} transition duration-300 pb-1`}
                    >
                      Links
                    </button>
                  </li>
                  <li>
                    <button
                      onClick={() => onNavigate('analytics')}
                      className={`font-semibold ${currentView === 'analytics' ? 'text-white border-b-2 border-white' : 'hover:text-purple-200'} transition duration-300 pb-1`}
                    >
                      Analytics
                    </button>
                  </li>
                </ul>
              </nav>
            </div>
          </header>
        );

        // Footer Component
        const Footer = () => (
          <footer className="bg-gray-800 text-gray-300 p-6 rounded-b-xl text-center mt-8 shadow-inner relative z-20">
            <div className="container mx-auto">
              <p>&copy; {new Date().getFullYear()} LinkSnap. All rights reserved.</p>
              <p className="text-sm mt-2">Built with React & Tailwind CSS</p>
            </div>
          </footer>
        );

        // URL Shortener Form Component
        const URLShortenerForm = ({ onShorten, isLoading }) => {
          const [longUrl, setLongUrl] = useState('');
          const [customAlias, setCustomAlias] = useState('');
          const [error, setError] = useState('');

          const handleSubmit = async (e) => {
            e.preventDefault();
            setError('');
            if (!longUrl) {
              setError('Please enter a URL to shorten.');
              return;
            }
            // Basic URL validation
            try {
              new URL(longUrl);
            } catch (_) {
              setError('Please enter a valid URL.');
              return;
            }
            await onShorten(longUrl, customAlias); // Await the async operation
            setLongUrl('');
            setCustomAlias('');
          };

          return (
            <div className="bg-white p-8 rounded-lg shadow-2xl max-w-2xl mx-auto my-8 border border-gray-100 transform hover:scale-[1.005] transition-transform duration-300 ease-in-out relative z-10">
              <h2 className="text-3xl font-extrabold text-gray-800 mb-6 text-center">Shorten Your URL Instantly</h2>
              <form onSubmit={handleSubmit} className="space-y-6">
                <div>
                  <label htmlFor="longUrl" className="block text-sm font-medium text-gray-700 mb-2">
                    Long URL
                  </label>
                  <div className="relative">
                    <input
                      type="url"
                      id="longUrl"
                      className="w-full p-3 pr-10 border border-gray-300 rounded-lg focus:ring-purple-500 focus:border-purple-500 transition duration-200 text-lg"
                      placeholder="e.g., https://very-long-website.com/some/path/to/a/resource"
                      value={longUrl}
                      onChange={(e) => setLongUrl(e.target.value)}
                      required
                      disabled={isLoading}
                    />
                    {longUrl && !isLoading && (
                      <button
                        type="button"
                        onClick={() => setLongUrl('')}
                        className="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700 focus:outline-none transition-colors duration-200"
                      >
                        <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                          <path fillRule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clipRule="evenodd" />
                        </svg>
                      </button>
                    )}
                  </div>
                </div>
                <div>
                  <label htmlFor="customAlias" className="block text-sm font-medium text-gray-700 mb-2">
                    Custom Alias (Optional)
                  </label>
                  <div className="relative">
                    <input
                      type="text"
                      id="customAlias"
                      className="w-full p-3 pr-10 border border-gray-300 rounded-lg focus:ring-purple-500 focus:border-purple-500 transition duration-200 text-lg"
                      placeholder="e.g., my-awesome-link"
                      value={customAlias}
                      onChange={(e) => setCustomAlias(e.target.value.replace(/[^a-zA-Z0-9-]/g, '').toLowerCase())} // Sanitize input
                      disabled={isLoading}
                    />
                    {customAlias && !isLoading && (
                      <button
                        type="button"
                        onClick={() => setCustomAlias('')}
                        className="absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700 focus:outline-none transition-colors duration-200"
                      >
                        <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                          <path fillRule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clipRule="evenodd" />
                        </svg>
                      </button>
                    )}
                  </div>
                  <p className="text-xs text-gray-500 mt-1">Only letters, numbers, and hyphens allowed.</p>
                </div>
                {error && <p className="text-red-500 text-sm">{error}</p>}
                <button
                  type="submit"
                  className="w-full bg-gradient-to-r from-purple-600 to-indigo-600 text-white py-3 px-6 rounded-lg font-semibold text-xl hover:from-purple-700 hover:to-indigo-700 transition duration-300 ease-in-out transform hover:scale-105 shadow-lg flex items-center justify-center"
                  disabled={isLoading}
                >
                  {isLoading ? (
                    <svg className="animate-spin h-6 w-6 text-white mr-3" viewBox="0 0 24 24">
                      <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                      <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                  ) : (
                    'Shorten LinkSnap URL'
                  )}
                </button>
              </form>
            </div>
          );
        };

        // Link Display Component
        const LinkDisplay = ({ shortLink, longUrl, qrCodeData, onCopy, onShortenAnother, isQrLoading }) => {
          const [copied, setCopied] = useState(false);

          useEffect(() => {
            if (copied) {
              const timer = setTimeout(() => setCopied(false), 2000);
              return () => clearTimeout(timer);
            }
          }, [copied]);

          if (!shortLink) return null;

          return (
            <div className="bg-white p-8 rounded-lg shadow-2xl max-w-2xl mx-auto my-8 border border-gray-100 animate-fadeIn transform hover:scale-[1.005] transition-transform duration-300 ease-in-out relative z-10">
              <h2 className="text-2xl font-semibold text-gray-800 mb-6 text-center">Your New LinkSnap URL!</h2>
              <div className="flex flex-col md:flex-row items-center justify-between space-y-6 md:space-y-0 md:space-x-8">
                <div className="flex-1 text-center md:text-left">
                  <p className="text-gray-600 text-sm mb-2 truncate">Original URL: <a href={longUrl} target="_blank" rel="noopener noreferrer" className="text-blue-600 hover:underline">{longUrl}</a></p>
                  <div className="bg-gray-100 p-4 rounded-lg flex items-center justify-between border border-gray-300 shadow-inner">
                    <a href={shortLink} target="_blank" rel="noopener noreferrer" className="text-purple-700 font-bold text-xl md:text-2xl break-all hover:underline">
                      {shortLink}
                    </a>
                    <button
                      onClick={() => { onCopy(shortLink); setCopied(true); }}
                      className="ml-4 bg-gradient-to-r from-green-500 to-teal-500 text-white p-2 rounded-md hover:from-green-600 hover:to-teal-600 transition duration-300 text-sm flex items-center shadow-md min-w-[90px] justify-center transform hover:scale-105"
                    >
                      {copied ? (
                        <>
                          <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor">
                            <path fillRule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clipRule="evenodd" />
                          </svg>
                          Copied!
                        </>
                      ) : (
                        <>
                          <svg xmlns="http://www.w3.org/2000/svg" className="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                            <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2H6zM5 9a1 1 0 011-1h8a1 1 0 110 2H6a1 1 0 01-1-1z" />
                          </svg>
                          Copy
                        </>
                      )}
                    </button>
                  </div>
                </div>
                <div className="flex-shrink-0 p-4 bg-gray-50 rounded-lg border border-gray-200 shadow-md">
                  <h3 className="text-lg font-medium text-gray-700 mb-2 text-center">QR Code</h3>
                  {isQrLoading ? (
                    <div className="w-32 h-32 bg-gray-200 flex items-center justify-center text-gray-500 text-sm rounded-md">
                      <svg className="animate-spin h-6 w-6 text-gray-500" viewBox="0 0 24 24">
                        <circle className="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" strokeWidth="4"></circle>
                        <path className="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                      </svg>
                    </div>
                  ) : qrCodeData ? (
                    <img src={qrCodeData} alt="QR Code" className="w-32 h-32 mx-auto rounded-lg border border-gray-300" />
                  ) : (
                    <div className="w-32 h-32 bg-gray-200 flex items-center justify-center text-gray-500 text-sm rounded-md">No QR</div>
                  )}
                </div>
              </div>
              <div className="mt-8 text-center">
                <button
                  onClick={onShortenAnother}
                  className="bg-gradient-to-r from-indigo-600 to-blue-600 text-white py-2 px-5 rounded-lg font-semibold hover:from-indigo-700 hover:to-blue-700 transition duration-300 ease-in-out transform hover:scale-105 shadow-md"
                >
                  Shorten Another Link
                </button>
              </div>
            </div>
          );
        };

        // Recent Links Section Component (now part of LinksView)
        const LinksList = ({ links, onCopyLink, onShowQrCode }) => {
          if (links.length === 0) {
            return (
              <div className="bg-white p-8 rounded-lg shadow-2xl max-w-4xl mx-auto my-8 border border-gray-100 relative z-10">
                <h2 className="text-2xl font-semibold text-gray-800 mb-6 text-center">Your Shortened Links</h2>
                <p className="text-gray-500 text-center">No links shortened yet. Go to Home to shorten your first link!</p>
              </div>
            );
          }

          return (
            <div className="bg-white p-8 rounded-lg shadow-2xl max-w-4xl mx-auto my-8 border border-gray-100 relative z-10">
              <h2 className="text-2xl font-semibold text-gray-800 mb-6 text-center">Your Shortened Links</h2>
              <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                {links.slice().reverse().map((link) => ( // Display all links, most recent first
                  <div key={link.id} className="bg-gray-50 p-5 rounded-lg border border-gray-200 shadow-sm flex flex-col justify-between transition-transform transform hover:scale-[1.02] hover:shadow-md duration-200 ease-in-out">
                    <div>
                      <p className="text-sm text-gray-500 truncate mb-1">Original:</p>
                      <a href={link.long} target="_blank" rel="noopener noreferrer" className="text-blue-600 hover:underline text-xs block truncate mb-3" title={link.long}>
                        {link.long}
                      </a>
                      <p className="text-sm text-gray-500 truncate mb-1">Short:</p>
                      <a href={link.short} target="_blank" rel="noopener noreferrer" className="text-purple-700 font-bold text-lg block truncate hover:underline" title={link.short}>
                        {link.short}
                      </a>
                    </div>
                    <div className="flex justify-end space-x-2 mt-4">
                      <button
                        onClick={() => onCopyLink(link.short)}
                        className="bg-gradient-to-r from-green-500 to-teal-500 text-white p-2 rounded-md hover:from-green-600 hover:to-teal-600 transition duration-300 text-xs flex items-center shadow-sm"
                      >
                        <svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4 mr-1" viewBox="0 0 20 20" fill="currentColor">
                          <path d="M8 3a1 1 0 011-1h2a1 1 0 110 2H9a1 1 0 01-1-1z" />
                          <path d="M6 3a2 2 0 00-2 2v11a2 2 0 002 2h8a2 2 0 002-2V5a2 2 0 00-2-2H6zM5 9a1 1 0 011-1h8a1 1 0 110 2H6a1 1 0 01-1-1z" />
                        </svg>
                        Copy
                      </button>
                      <button
                        onClick={() => onShowQrCode(link)}
                        className="bg-gradient-to-r from-blue-500 to-cyan-500 text-white p-2 rounded-md hover:from-blue-600 hover:to-cyan-600 transition duration-300 text-xs flex items-center shadow-sm"
                      >
                        <svg xmlns="http://www.w3.org/2000/svg" className="h-4 w-4 mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                          <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                          <line x1="12" y1="8" x2="12" y2="16"></line>
                          <line x1="8" y1="12" x2="16" y2="12"></line>
                        </svg>
                        QR
                      </button>
                    </div>
                  </div>
                ))}
              </div>
            </div>
          );
        };


        // Analytics Dashboard Component
        const AnalyticsDashboard = ({ links }) => {
          // Destructure Recharts components here, where they are used
          const { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } = window.Recharts;

          // Dummy data for the chart
          const analyticsData = [
            { name: 'Jan', clicks: 4000 },
            { name: 'Feb', clicks: 3000 },
            { name: 'Mar', clicks: 2000 },
            { name: 'Apr', clicks: 2780 },
            { name: 'May', clicks: 1890 },
            { name: 'Jun', clicks: 2390 },
            { name: 'Jul', clicks: 3490 },
          ];

          return (
            <div className="bg-white p-8 rounded-lg shadow-2xl max-w-4xl mx-auto my-8 border border-gray-100 relative z-10">
              <h2 className="text-2xl font-semibold text-gray-800 mb-6 text-center">Performance Analytics</h2>

              <div className="mb-8">
                <h3 className="text-xl font-medium text-gray-700 mb-4">Click Trends (Simulated)</h3>
                <ResponsiveContainer width="100%" height={300}>
                  <LineChart
                    data={analyticsData}
                    margin={{ top: 5, right: 30, left: 20, bottom: 5 }}
                  >
                    <CartesianGrid strokeDasharray="3 3" stroke="#e0e0e0" />
                    <XAxis dataKey="name" stroke="#555" />
                    <YAxis stroke="#555" />
                    <Tooltip
                      contentStyle={{ backgroundColor: '#fff', border: '1px solid #ccc', borderRadius: '8px', padding: '10px' }}
                      labelStyle={{ color: '#333', fontWeight: 'bold' }}
                      itemStyle={{ color: '#666' }}
                    />
                    <Legend wrapperStyle={{ paddingTop: '10px' }} />
                    <Line type="monotone" dataKey="clicks" stroke="#8884d8" activeDot={{ r: 8 }} strokeWidth={2} />
                  </LineChart>
                </ResponsiveContainer>
              </div>

              <div>
                <h3 className="text-xl font-medium text-gray-700 mb-4">All Shortened Links Data</h3>
                {links.length === 0 ? (
                  <p className="text-gray-500 text-center">No links data available. Shorten one on the Home page!</p>
                ) : (
                  <div className="overflow-x-auto">
                    <table className="min-w-full bg-white border border-gray-200 rounded-lg">
                      <thead>
                        <tr className="bg-gray-100 text-gray-600 uppercase text-sm leading-normal">
                          <th className="py-3 px-6 text-left">Short Link</th>
                          <th className="py-3 px-6 text-left">Original URL</th>
                          <th className="py-3 px-6 text-center">Clicks (Simulated)</th>
                        </tr>
                      </thead>
                      <tbody className="text-gray-700 text-sm font-light">
                        {links.map((link, index) => (
                          <tr key={index} className="border-b border-gray-200 hover:bg-gray-50">
                            <td className="py-3 px-6 text-left whitespace-nowrap">
                              <a href={link.short} target="_blank" rel="noopener noreferrer" className="text-purple-600 hover:underline font-medium">
                                {link.short}
                              </a>
                            </td>
                            <td className="py-3 px-6 text-left max-w-xs truncate">
                              <a href={link.long} target="_blank" rel="noopener noreferrer" className="text-blue-500 hover:underline">
                                {link.long}
                              </a>
                            </td>
                            <td className="py-3 px-6 text-center font-bold">
                              {link.clicks}
                            </td>
                          </tr>
                        ))}
                      </tbody>
                    </table>
                  </div>
                )}
              </div>
            </div>
          );
        };

        // Home View Component
        const HomeView = ({ onShorten, isLoading, currentShortenedLink, qrCodeData, onCopy, onShortenAnother, isQrLoading }) => (
          <>
            <URLShortenerForm onShorten={onShorten} isLoading={isLoading} />
            <LinkDisplay
              shortLink={currentShortenedLink?.short}
              longUrl={currentShortenedLink?.long}
              qrCodeData={qrCodeData}
              onCopy={copyToClipboard}
              onShortenAnother={onShortenAnother}
              isQrLoading={isQrLoading}
            />
          </>
        );

        // Links View Component
        const LinksView = ({ shortenedLinks, onCopyLink, onShowQrCode }) => (
          <LinksList links={shortenedLinks} onCopyLink={onCopyLink} onShowQrCode={onShowQrCode} />
        );

        // Analytics View Component
        const AnalyticsView = ({ shortenedLinks }) => (
          <AnalyticsDashboard links={shortenedLinks} />
        );


        // Main App Component
        const App = () => {
          const [shortenedLinks, setShortenedLinks] = useState([]);
          const [currentShortenedLink, setCurrentShortenedLink] = useState(null);
          const [qrCodeData, setQrCodeData] = useState('');
          const [isLoading, setIsLoading] = useState(false);
          const [isQrLoading, setIsQrLoading] = useState(false);
          const [toast, setToast] = useState(null);
          const [currentView, setCurrentView] = useState('home'); // State for navigation

          // Function to simulate URL shortening
          const handleShorten = useCallback(async (longUrl, customAlias) => {
            setIsLoading(true);
            setCurrentShortenedLink(null);
            setQrCodeData('');
            setIsQrLoading(true);

            await new Promise(resolve => setTimeout(resolve, 1000));

            const base = 'https://short.ly/';
            const generatedAlias = customAlias || Math.random().toString(36).substring(2, 8);
            const short = `${base}${generatedAlias}`;

            const newLink = {
              long: longUrl,
              short: short,
              clicks: Math.floor(Math.random() * 1000) + 50,
              id: Date.now(),
            };

            setShortenedLinks((prevLinks) => [...prevLinks, newLink]);
            setCurrentShortenedLink(newLink);

            await new Promise(resolve => setTimeout(resolve, 500));
            setQrCodeData(generateQRCodeSVG(short));
            setIsQrLoading(false);

            setIsLoading(false);
          }, []);

          // Function to copy text to clipboard
          const copyToClipboard = useCallback((text) => {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            try {
              document.execCommand('copy');
              setToast({ message: 'Copied to clipboard!', type: 'success' });
            } catch (err) {
              console.error('Failed to copy: ', err);
              setToast({ message: 'Failed to copy link. Please copy manually.', type: 'error' });
            }
            document.body.removeChild(textarea);
          }, []);

          // Function to clear the current shortened link and allow new shortening
          const handleShortenAnother = useCallback(() => {
            setCurrentShortenedLink(null);
            setQrCodeData('');
          }, []);

          // Function to show QR code for a link from the recent links section
          const handleShowQrCodeFromRecent = useCallback((link) => {
            setCurrentView('home'); // Navigate to home to show the QR code in the main display
            setCurrentShortenedLink(link);
            setIsQrLoading(true);
            setQrCodeData('');
            setTimeout(() => {
              setQrCodeData(generateQRCodeSVG(link.short));
              setIsQrLoading(false);
            }, 500);
          }, []);

          return (
            <div className="min-h-screen bg-gradient-to-br from-gray-50 to-gray-200 font-sans text-gray-900 antialiased p-4 sm:p-6 lg:p-8 relative overflow-hidden">
              <ThreeJSBackground /> {/* 3D background */}

              <div className="max-w-6xl mx-auto relative z-10">
                <Header onNavigate={setCurrentView} currentView={currentView} />
                <main className="py-8">
                  {currentView === 'home' && (
                    <HomeView
                      onShorten={handleShorten}
                      isLoading={isLoading}
                      currentShortenedLink={currentShortenedLink}
                      qrCodeData={qrCodeData}
                      onCopy={copyToClipboard}
                      onShortenAnother={handleShortenAnother}
                      isQrLoading={isQrLoading}
                    />
                  )}
                  {currentView === 'links' && (
                    <LinksView
                      shortenedLinks={shortenedLinks}
                      onCopyLink={copyToClipboard}
                      onShowQrCode={handleShowQrCodeFromRecent}
                    />
                  )}
                  {currentView === 'analytics' && (
                    <AnalyticsView
                      shortenedLinks={shortenedLinks}
                    />
                  )}
                </main>
                <Footer />
              </div>
              {toast && (
                <Toast
                  message={toast.message}
                  type={toast.type}
                  onClose={() => setToast(null)}
                />
              )}
            </div>
          );
        };

        // Render the App component ONLY after the DOM is fully loaded
        document.addEventListener('DOMContentLoaded', function() {
            ReactDOM.createRoot(document.getElementById('root')).render(<App />);
        });
    </script>
</body>
</html>
